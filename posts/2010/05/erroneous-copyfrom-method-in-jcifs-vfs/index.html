<!DOCTYPE html>
<html lang="en">
  <head>
    <link href='http://fonts.googleapis.com/css?family=Rosarivo' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Merriweather:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <meta charset="utf-8">
    <title>Erroneous copyFrom() method in JCIFS/VFS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Stefan Oderbolz (&quot;Odi&quot;)">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- load static files from bower -->
    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" media="all">
    <script src="/bower_components/jquery/jquery.js"></script>
    <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Le styles -->
<link href='/assets/stylesheets/style-19503cb7a292d7f3dede6225b80f1d8c.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/google_prettify/sons-of-obsidian-afb0925bfa2d994f17dab93e13fbf999.css' type='text/css' rel='stylesheet' media='all'>    
    <!-- Le scripts -->

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" />

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

  -->
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">metaodi</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            
              <li><a href="/tags">Tags</a></li>
            
            
              <li><a href="/archive">Archive</a></li>
            
            
              <li><a href="/about">About me</a></li>
            
        </ul>
      </div><!-- /.navbar-collapse -->
    </div>
    </nav>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Erroneous copyFrom() method in JCIFS/VFS </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>30.05.2010</strong>
    </div>
    <div class="content">
      <p>At the <a href="http://www.hsr.ch">HSR (University of Applied Science
Rapperswil)</a> we are currently developing a software
to synchronize files from the central fileserver to the students
computers. This should help the students to get the latest slides for
their lectures.</p>

<p>The software is based on <a href="http://commons.apache.org/vfs/">VFS (Virtual
Filesystem)</a> from the <a href="http://commons.apache.org/">Apache Commons
project</a>. The file server is a classic Samba
server that uses the CIFS protocol, and with the use of VFS we ensured a
common access the the filesystem, no matter if it’s the remote
filesystem of the file server or the local filesystem on the student’s
computers.</p>

<p>At a point we got a very strange error: we could copy files from the
remote system, but when we delete the files while the application is
running, and try to copy the files again, the copy fails:</p>

<pre><code>FileSystemException &quot;could not copy [source-path] to [target-path]&quot;.
</code></pre>

<p>We figured out, that the problem were the folders that don’t exist yet.
But according the the <a href="http://commons.apache.org/vfs/apidocs/org/apache/commons/vfs/FileObject.html#copyFrom%28org.apache.commons.vfs.FileObject,%20org.apache.commons.vfs.FileSelector%29">documentation of the the copyFrom
method</a>
the parent folder should be created if it does not exist. This is also
the case when we do the first-time-copy, which works like a charm.</p>

<p>After serveral tries with refresh() etc. to bring the FileObjects and
the actual filesystem to sync, we finally implemented this workaround,
maybe somebody else can use it:</p>

<pre><code>protected void copyFile(FileObject targetFile, FileObject sourceFile) {
    try {
        FileObject parentFile = targetFile.getParent();
        parentFile.refresh();
        log.debug(&quot;Parent exists?: &quot; + parentFile.exists());

        if (!parentFile.exists()) {
            parentFile.createFolder();
            log.debug(&quot; =&gt; Folder created&quot;);
        }
        targetFile.copyFrom(sourceFile),new AllFileSelector());
    } catch (FileSystemException e) {
        log.warn(&quot;Could not copy file, FileSystemException: &quot;
                + e.getMessage());
    }
}
</code></pre>

<p>(the above code is a little bit simplified, and the use of an extra
FileObject for the parent is not absolutely necessary, but it clarifies
the code)</p>

<p>In my opinion the copyFrom implementation of
<a href="http://jcifs.samba.org/">JCFIS</a> (which is the Samba part of VFS) does
not work, i.e. this is a bug. But I’m not sure, maybe we overlook an
obvious thing on our side. Fact is, the above solution works for us. The
JCIFS is part of the VFS sandbox, this means the library is still in
development. Maybe I’ll file a bug, if I can clearly reproduce this
behavior.</p>

    </div>
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
    </ul>
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      <li>
        <a href="/tags#Java, JCIFS, VFS-ref">Java, JCIFS, VFS <span>1</span></a>
      </li>
    </ul>
    <hr>
    <ul class="pagination">
        <li class="prev"><a href="/posts/2009/12/guardian-how-do-i-know-china-wrecked-the-copenhagen" title="Guardian: How do I know China wrecked the Copenhagen deal? I was in the room">&larr; Previous</a></li>

        <li><a href="/archive">Archive</a></li>

        <li class="next"><a href="/posts/2010/07/using-utplsql-with-multiple-schemas" title="Using utPLSQL with multiple schemas">Next &rarr;</a></li>
    </ul>
    <hr>
    
  </div>
</div>


      </div>

      <hr>
      <div class="footer">
        <p>&copy; Stefan Oderbolz (&quot;Odi&quot;) 2014
          with <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
          and <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a>
        </p>
      </div>

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    
    
  </body>
</html>
